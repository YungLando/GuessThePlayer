<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guess The Player</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/css/autoComplete.min.css">
    <style>
        .correct { 
            background-color: #4ade80 !important;
            animation: flip 0.6s ease;
        }
        .partial { 
            background-color: #facc15 !important;
            animation: flip 0.6s ease;
        }
        .incorrect { 
            background-color: #ef4444 !important;
            animation: flip 0.6s ease;
        }
        
        .autoComplete_wrapper {
            width: 100%;
        }
        
        .autoComplete_result {
            padding: 0.5rem;
            cursor: pointer;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .autoComplete_result:hover {
            background-color: #f3f4f6;
        }
        
        .autoComplete_highlighted {
            color: #2563eb;
            font-weight: bold;
        }

        .search-result {
            display: flex;
            flex-direction: column;
        }

        .search-result-name {
            font-weight: 600;
            color: #111827;
        }

        .search-result-team {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 2px;
        }

        @keyframes flip {
            0% { transform: rotateX(0deg); }
            50% { transform: rotateX(90deg); }
            100% { transform: rotateX(0deg); }
        }

        .guess-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .guess-cell {
            padding: 12px;
            text-align: center;
            border-radius: 6px;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80px;
            background-color: #e5e7eb;
            border: 2px solid #d1d5db;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .flag-icon {
            width: 32px;
            height: 24px;
            margin-bottom: 4px;
            border: 1px solid #e5e7eb;
        }

        .header-cell {
            font-weight: bold;
            background-color: #1f2937;
            color: white;
            padding: 12px;
            text-align: center;
            border-radius: 6px;
        }

        #guesses {
            margin-top: 20px;
        }

        .guess-grid:not(:last-child) {
            margin-bottom: 12px;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold text-center mb-8">Guess The Player</h1>
        
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <input type="text" id="playerSearch" class="w-full p-2 border rounded mb-4" placeholder="Search for a player...">
                <button onclick="makeGuess()" class="w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">
                    Make Guess
                </button>
            </div>

            <!-- Headers -->
            <div class="guess-grid mb-2">
                <div class="header-cell">Player</div>
                <div class="header-cell">Nation</div>
                <div class="header-cell">League</div>
                <div class="header-cell">Team</div>
                <div class="header-cell">Position</div>
                <div class="header-cell">Age</div>
                <div class="header-cell">Value</div>
            </div>

            <div id="guesses" class="space-y-2">
                <!-- Guesses will be displayed here -->
            </div>
        </div>
    </div>

    <template id="guess-template">
        <div class="guess-grid">
            <div class="guess-cell player-name"></div>
            <div class="guess-cell nation"></div>
            <div class="guess-cell league"></div>
            <div class="guess-cell team"></div>
            <div class="guess-cell position"></div>
            <div class="guess-cell age"></div>
            <div class="guess-cell market-value"></div>
        </div>
    </template>

    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/autoComplete.min.js"></script>
    <script>
        let players = [];
        let selectedPlayer = null;
        
        // Initialize autocomplete
        const autoCompleteJS = new autoComplete({
            selector: "#playerSearch",
            placeHolder: "Search for a player...",
            data: {
                src: async (query) => {
                    try {
                        const response = await fetch(`/api/players/search?q=${encodeURIComponent(query)}`);
                        const data = await response.json();
                        return data;
                    } catch (error) {
                        return [];
                    }
                },
                keys: ["name"],
                cache: false,
            },
            resultsList: {
                element: (list, data) => {
                    if (!data.results.length) {
                        const message = document.createElement("div");
                        message.setAttribute("class", "no_result");
                        message.innerHTML = `<span>No results for "${data.query}"</span>`;
                        list.prepend(message);
                    }
                },
                noResults: true,
                maxResults: 10,
            },
            resultItem: {
                highlight: true,
                element: (item, data) => {
                    item.innerHTML = `
                        <div class="search-result">
                            <div class="search-result-name">${data.value.name}</div>
                            <div class="search-result-team">${data.value.team}</div>
                        </div>
                    `;
                }
            },
            events: {
                input: {
                    selection: (event) => {
                        const selection = event.detail.selection.value;
                        autoCompleteJS.input.value = selection.label;
                        selectedPlayer = selection;
                    }
                }
            }
        });
        
        // Function to make a guess
        async function makeGuess() {
            if (!selectedPlayer) {
                alert('Please select a player from the search results!');
                return;
            }

            try {
                const response = await fetch('/api/guess', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ guess: selectedPlayer }),
                });

                const feedback = await response.json();
                
                // Create a new guess element from the template
                const template = document.getElementById('guess-template');
                const guessElement = template.content.cloneNode(true);
                
                // Fill in the player data
                guessElement.querySelector('.player-name').textContent = selectedPlayer.name;
                
                // Set classes based on feedback
                if (feedback.correct) {
                    guessElement.querySelectorAll('.guess-cell').forEach(cell => {
                        cell.classList.add('correct');
                        // Fill in the correct data
                        if (cell.classList.contains('nation')) {
                            cell.textContent = selectedPlayer.nation;
                        } else if (cell.classList.contains('league')) {
                            cell.textContent = 'Premier League';
                        } else if (cell.classList.contains('team')) {
                            cell.textContent = selectedPlayer.team;
                        } else if (cell.classList.contains('position')) {
                            cell.textContent = selectedPlayer.position;
                        } else if (cell.classList.contains('age')) {
                            cell.textContent = selectedPlayer.age;
                        } else if (cell.classList.contains('market-value')) {
                            cell.textContent = selectedPlayer.market_value_display;
                        }
                    });
                    alert('Congratulations! You found the player!');
                } else {
                    // Nation
                    const nationCell = guessElement.querySelector('.nation');
                    nationCell.classList.add(feedback.nation ? 'correct' : 'incorrect');
                    nationCell.textContent = selectedPlayer.nation;
                    
                    // League
                    const leagueCell = guessElement.querySelector('.league');
                    leagueCell.classList.add(feedback.league ? 'correct' : 'incorrect');
                    leagueCell.textContent = 'Premier League';
                    
                    // Team
                    const teamCell = guessElement.querySelector('.team');
                    teamCell.classList.add(feedback.team ? 'correct' : 'incorrect');
                    teamCell.textContent = selectedPlayer.team;
                    
                    // Position
                    const positionCell = guessElement.querySelector('.position');
                    positionCell.textContent = selectedPlayer.position;
                    if (feedback.position.exact) {
                        positionCell.classList.add('correct');
                    } else if (feedback.position.similar) {
                        positionCell.classList.add('partial');
                    } else {
                        positionCell.classList.add('incorrect');
                    }
                    
                    // Age
                    const ageCell = guessElement.querySelector('.age');
                    ageCell.textContent = selectedPlayer.age;
                    if (feedback.age.correct) {
                        ageCell.classList.add('correct');
                    } else {
                        ageCell.classList.add('incorrect');
                        const arrow = feedback.age.higher ? '↑' : '↓';
                        ageCell.textContent = `${selectedPlayer.age} ${arrow}`;
                    }

                    // Market Value
                    const marketValueCell = guessElement.querySelector('.market-value');
                    marketValueCell.textContent = selectedPlayer.market_value_display;
                    if (feedback.market_value.correct) {
                        marketValueCell.classList.add('correct');
                    } else {
                        marketValueCell.classList.add('incorrect');
                        const arrow = feedback.market_value.higher ? '↑' : '↓';
                        marketValueCell.textContent = `${selectedPlayer.market_value_display} ${arrow}`;
                    }
                }
                
                // Add the guess to the guesses container
                document.getElementById('guesses').prepend(guessElement);
                
                // Clear the search input and selected player
                autoCompleteJS.input.value = '';
                selectedPlayer = null;
                
            } catch (error) {
                console.error('Error making guess:', error);
                alert('Error making guess. Please try again.');
            }
        }

        // Handle Enter key in search
        document.getElementById('playerSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                makeGuess();
            }
        });

        function getMarketValueFeedback(feedback) {
            if (feedback.correct) return '✓';
            if (feedback.higher) return `↑ (${feedback.display})`;
            if (feedback.lower) return `↓ (${feedback.display})`;
            return '✗';
        }

        function getFeedbackClass(feedback) {
            if (feedback.correct) return 'correct';
            if (feedback.higher || feedback.lower || feedback.similar) return 'partial';
            return 'incorrect';
        }
    </script>
</body>
</html> 